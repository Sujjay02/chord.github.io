<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Transposer</title>
    
    <script src="https://cdn.jsdelivr.net/npm/tonal/browser/tonal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>

    <div id="authModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none; justify-content: center; align-items: center;">
        <div class="container" style="max-width:350px;">
            <button onclick="closeAuth()" style="float:right; background:none; border:none; color:white; cursor:pointer;">âœ•</button>
            <h2 id="authTitle">Sign In</h2>
            <input type="email" id="authEmail" placeholder="Email">
            <input type="password" id="authPassword" placeholder="Password">
            <button onclick="handleAuth()" class="main-btn">Continue</button>
            <p style="text-align:center; margin-top:15px; cursor:pointer; font-size:0.9rem;" onclick="toggleAuthMode()" id="toggleText">Don't have an account? Sign Up</p>
        </div>
    </div>

    <div class="container">
        <div style="text-align: right; margin-bottom: 10px; font-size: 0.8rem;">
            <span id="userGreeting">Guest Mode</span>
            <button id="authBtn" onclick="openAuth()" style="background:none; border:none; color:var(--accent); cursor:pointer; text-decoration:underline; margin-left:10px;">Sign In</button>
        </div>
        
        <h1>Studio Transposer</h1>
        
        <div class="control-row">
            <div>
                <label>Mode</label>
                <select id="typeSelect">
                    <option value="note">Notes Only</option>
                    <option value="chord" selected>Chords</option>
                    <option value="numeral">Roman Numerals</option>
                </select>
            </div>
            <div>
                <label>Key (for Numerals)</label>
                <input type="text" id="keyInput" value="C">
            </div>
        </div>

        <textarea id="userInput" placeholder="Enter music here..." rows="3"></textarea>
        
        <div class="control-row">
            <div><label>Shift (Semitones)</label><input type="number" id="semitones" value="2"></div>
            <div><label>Accidentals</label><select id="accidentalType"><option value="auto">Auto</option><option value="sharp"># Sharps</option><option value="flat">b Flats</option></select></div>
        </div>

        <button class="main-btn" onclick="handleTranspose()">Transpose & Play</button>

        <div id="outputSection">
            <h2 id="resultText">--</h2>
            <div class="button-group">
                <button onclick="copyToClipboard()" class="secondary-btn" style="background:#444">Copy</button>
                <button onclick="playMusic()" class="secondary-btn" style="background:#6f42c1">ðŸ”Š Listen</button>
            </div>
        </div>

        <div id="librarySection" style="display:none; margin-top:20px; padding-top:20px; border-top:1px solid #444;">
            <label>Save to Library</label>
            <div class="control-row">
                <input type="text" id="songTitle" placeholder="Song Name">
                <button onclick="saveSong()" class="secondary-btn" style="background:#28a745; max-width:100px;">Save</button>
            </div>
            <ul id="songsList"></ul>
        </div>
        
        <div id="guestMsg" style="text-align:center; color:#888; margin-top:20px; font-size:0.9rem;">Sign in to save songs to your library.</div>

        <div class="piano" id="piano"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>