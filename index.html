<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Studio Transposer</title>
    
    <script src="https://cdn.jsdelivr.net/npm/tonal/browser/tonal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --accent: #00d4ff;
            --text: #e0e0e0;
            --white-key: #ffffff;
            --black-key: #333;
        }

        body { 
            background: var(--bg); color: var(--text); 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            display: flex; justify-content: center; padding: 20px;
        }

        .container { 
            background: var(--card); padding: 2rem; border-radius: 20px; 
            width: 100%; max-width: 600px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
        }

        /* Auth Overlay */
        #authOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 1000; display: flex; 
            justify-content: center; align-items: center;
        }

        h1, h2 { text-align: center; color: var(--accent); }
        .control-row { display: flex; gap: 15px; margin-bottom: 10px; }
        .control-row div { flex: 1; }

        input, select, textarea { 
            width: 100%; background: #2d2d2d; border: 1px solid #444; 
            color: white; padding: 12px; border-radius: 8px; margin-top: 5px;
            box-sizing: border-box; font-size: 1rem;
        }

        .main-btn { 
            width: 100%; background: var(--accent); color: #000; font-weight: bold;
            padding: 15px; border: none; border-radius: 8px; cursor: pointer; 
            margin-top: 20px; font-size: 1.1rem;
        }

        #outputSection { background: #2d2d2d; margin-top: 25px; padding: 20px; border-radius: 10px; text-align: center; }
        #resultText { color: var(--accent); font-size: 1.8rem; margin: 10px 0; }

        .button-group { display: flex; gap: 10px; margin-top: 15px; }
        .secondary-btn { flex: 1; padding: 10px; border: none; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; }

        /* Piano UI */
        .piano { display: flex; justify-content: center; height: 100px; margin-top: 30px; position: relative; }
        .key { border: 1px solid #888; background: var(--white-key); width: 35px; height: 100%; border-radius: 0 0 5px 5px; z-index: 1; box-sizing: border-box; }
        .key.black { background: var(--black-key); width: 22px; height: 60%; margin-left: -11px; margin-right: -11px; z-index: 2; border: none; }
        .key.active { background: var(--accent) !important; transform: translateY(2px); }

        /* Song Library */
        #songsList li { 
            display: flex; justify-content: space-between; align-items: center;
            background: #2d2d2d; padding: 10px; margin-bottom: 5px; border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="authOverlay">
        <div class="container" style="max-width:350px;">
            <h2 id="authTitle">Sign In</h2>
            <input type="email" id="authEmail" placeholder="Email">
            <input type="password" id="authPassword" placeholder="Password">
            <button onclick="handleAuth()" class="main-btn">Continue</button>
            <p style="text-align:center; margin-top:15px; cursor:pointer; font-size:0.9rem;" onclick="toggleAuthMode()" id="toggleText">
                Don't have an account? Sign Up
            </p>
        </div>
    </div>

    <div class="container">
        <button onclick="logout()" id="logoutBtn" style="position:absolute; top:20px; right:20px; background:none; border:none; color:#ff4444; cursor:pointer;">Logout</button>
        <h1>Studio Transposer</h1>
        
        <div class="control-row">
            <div>
                <label>Mode</label>
                <select id="typeSelect">
                    <option value="note">Notes Only</option>
                    <option value="chord" selected>Chords</option>
                    <option value="numeral">Roman Numerals</option>
                </select>
            </div>
            <div>
                <label>Key (for Numerals)</label>
                <input type="text" id="keyInput" value="C">
            </div>
        </div>

        <textarea id="userInput" placeholder="Enter music (e.g. C E G)" rows="3"></textarea>
        
        <div class="control-row">
            <div><label>Shift (Semitones)</label><input type="number" id="semitones" value="2"></div>
            <div><label>Accidentals</label><select id="accidentalType"><option value="auto">Auto</option><option value="sharp"># Sharps</option><option value="flat">b Flats</option></select></div>
        </div>

        <button class="main-btn" onclick="handleTranspose()">Transpose & Play</button>

        <div id="outputSection">
            <h2 id="resultText">--</h2>
            <div class="button-group">
                <button onclick="copyToClipboard()" class="secondary-btn" style="background:#444">Copy</button>
                <button onclick="playMusic()" class="secondary-btn" style="background:#6f42c1">ðŸ”Š Listen</button>
            </div>
        </div>

        <div style="margin-top:20px; padding-top:20px; border-top:1px solid #444;">
            <label>Save to Library</label>
            <div class="control-row">
                <input type="text" id="songTitle" placeholder="Song Name">
                <button onclick="saveSong()" class="secondary-btn" style="background:#28a745; max-width:100px;">Save</button>
            </div>
            <ul id="songsList"></ul>
        </div>

        <div class="piano" id="piano"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>